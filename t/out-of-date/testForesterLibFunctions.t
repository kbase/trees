#!/usr/bin/perl
# This script tests the service calls which use the forester java library, which is currently
# used only for parsing newicks and phyloXML.
#
#  author:  msneddon
#  created: 9/9/2012
use strict;
use warnings;

use Test::More tests => 3;
use Data::Dumper;
use Test::More;
use lib "../lib/";

# MAKE SURE WE LOCALLY HAVE JSON RPC LIBS INSTALLED
#  NOTE: for initial testing, you may have to modify TreesClient.pm to also
#        point to the legacy interface
use_ok("JSON::RPC::Legacy::Client");
use_ok("Bio::KBase::Tree::Client");

# MAKE A CONNECTION AND ENSURE WE ARE CONNECTED
my $tree_service_url = "http://140.221.92.144:7047";
my $client = Bio::KBase::Tree::Client->new($tree_service_url);
ok(defined($client),"instantiating tree client");

######### TEST SET 1 ######### 
# CONVERT STRING TO ALTERNATE FORMATS
my $newick = "(((5907501_1_5_524:1.26098,939255_1_203_318:1.04462)0.262:0.34521,(231795_1_2_751:0.61695,((20760_1_5_729:0.27463,((10382578_1_1_774:0.1798,(6342743_1_1_749:0.00016,3697233_1_1_749:0.00276)1:0.21525)0.999:0.14379,1109823_1_12_632:0.39205)0.39:0.07)0.999:0.17663,(((7657015_1_1_758:0.03292,(9790_1_1_758:0.00388,(7640154_1_1_758:0.02027,10419989_1_1_758:0.0087)0.43:0.00503)0.841:0.01575)0.932:0.19414,(3687963_1_1_756:0.18296,(4917078_1_1_757:0.20553,(3659095_1_1_754:0.11491,(533513_1_1_758:0.01459,(3753464_1_1_758:0.01979,(3704235_1_1_758:0.02105,3636841_1_1_758:0.01495)0.899:0.01098)0.92:0.01228)1:0.07579)0.995:0.07199)0.996:0.08867)1:0.10831)1:0.28175,((188104_1_2_738:0.04605,(6200_1_2_738:0.02655,30268_1_2_738:0.03106)0.945:0.03446)0.949:0.03914,((5779798_1_3_738:0.03847,(938353_1_3_738:0.0283,7693339_1_66_801:0.02349)0.996:0.02997)0.879:0.02428,7708150_1_3_738:0.14705)0.992:0.07784)1:0.46783)0.659:0.08521)0.293:0.05343)0.937:0.09357)0.94:0.005655,((((((1761530_1_1_703:0.18659,10321541_1_1_702:0.23264)0.95:0.1849,(1109034_1_1_708:0.04636,(249999_1_1_708:0.03397,234221_1_5_712:0.04168)0.908:0.04121)1:0.21247)1:0.17091,1935201_1_11_711:0.31819)0.948:0.07379,(((2005944_1_5_607:0.21615,((2103060_1_4_604:0.00039,7313679_1_402_511:0.8385)1:0.32518,(3781061_1_3_605:0.20818,5770759_1_3_607:0.17101)0.971:0.05203)0.819:0.04503)0.96:0.05069,1258398_1_6_607:0.34045)1:0.22899,10156748_1_1_698:0.36556)0.705:0.06386)0.979:0.10853,(((1116033_1_13_619:0.23342,(((7451428_1_15_619:0.16361,747960_1_15_619:0.15827)0.982:0.06889,7508881_1_23_623:0.26637)0.951:0.05382,(7235879_1_13_632:0.1914,(10159479_1_22_621:0.10983,1994107_1_23_622:0.28603)0.985:0.06414)1:0.11435)0.703:0.04013)0.946:0.05194,(10312118_1_17_617:0.06854,10322289_1_17_620:0.06264)0.046:0.19768)0.025:0.03427,(68738_1_1_44:0.00015,(3796409_1_1_616:0.00014,68737_1_1_604:0.10815)0.945:0.00016)1:0.31288)1:0.54044)0.93:0.08919,(((((((3787353_1_125_201:0.47954,10037881_1_86_147:1.34092)0.793:0.2579,((7372485_1_444_548:1.2081,7006144_1_281_360:0.68721)0:0.00016,(9488101_1_89_148:1.11,6046768_1_1_64:0.52606)0.848:0.44086)0.768:0.08583)0.899:0.2852,3189211_1_174_279:1.18135)0.725:0.11043,(9401427_1_49_116:1.2292,(1783406_1_113_210:0.69974,5649301_1_585_678:1.25556)0:0.01173)0.643:0.19879)0.271:0.08246,(9958397_1_239_317:1.27091,(3798478_1_1_81:0.59803,4578011_1_781_896:0.71319)0.735:0.67447)0.395:0.2719)0.681:0.06811,(10344680_1_1_690:0.1284,(23200_1_1_692:0.15842,10361989_1_1_690:0.22285)0.76:0.03488)0.999:0.40758)0.524:0.1051,((7372485_1_504_628:0.86017,1994318_1_20_87:0.39764)0.608:0.42565,(((10408451_1_115_214:1.8024,(233938_1_62_120:0.14776,249757_1_8_66:0.01856)0.868:0.5447)0.391:0.11328,((((5472393_1_307_440:0.85268,((2246066_1_84_183:0.4056,((7028660_1_257_349:0.13236,7028660_1_313_431:0.31204)0.996:0.79986,(((3549922_1_361_489:0.58696,(2246066_1_15_135:0.00015,7313679_1_294_414:0.01789)0.994:0.71377)0.859:0.29107,7313679_1_278_367:0.6611)0.752:0.13283,2246066_1_123_214:0.35864)0.836:0.19744)0.84:0.14811)0.706:0.06161,((6339980_1_141_242:0.32812,(4875077_1_122_221:0.09644,(4189975_1_118_218:0.03692,4194394_1_163_262:0.14091)0.984:0.20162)0.431:0.05795)0.897:0.27279,(9488999_1_58_342:0.27673,3549922_1_263_383:0.12955)0.5:0.67001)0.473:0.13697)0.257:0.09708)0.821:0.26526,(1762670_1_555_665:0.55844,((185894_1_613_737:0.00015,((1802037_1_613_737:0,2167773_1_613_737:0):0.00015,4746904_1_613_737:0.00659)0.49:0.00658)0.998:0.57633,((10375468_1_628_737:0,10319228_1_628_737:0):0.21487,(6130208_1_626_748:0,39900_3_626_748:0,6134733_1_626_748:0,6139133_1_626_748:0):0.13143)0.938:0.37494)0.779:0.16203)0.253:0.10033)0.839:0.18061,(6947921_1_264_360:0.01677,7172705_1_273_360:0.05177)0.997:0.63808)0.595:0.08618,(864883_3_1_116:0.09461,10480228_1_1_115:0.02328)0.999:0.66896)0.04:0.01102)0.639:0.22666,((69298_1_2_684:0.00014,3796998_1_1_682:0.00014)1:0.33305,(((10161347_1_4_728:0.22584,(1994318_1_222_764:0.38849,1994318_1_4_107:0.17359)0.97:0.08641)0.991:0.08835,7235074_1_1_722:0.33784)0.999:0.09993,(1115854_1_1_687:0.38366,((7511135_1_1_726:0.41767,(7451728_1_1_730:0.21765,747531_1_1_723:0.26106)0.991:0.11596)0.969:0.07254,(10312733_1_1_735:0.12959,10322548_1_1_732:0.14731)0.982:0.31958)0.836:0.05813)0.915:0.03647)0.918:0.11938)1:1.30162)0.759:0.0503)0.86:0.10273)0.779:0.05153)0.94:0.090195);";
my $phylo_xml = $client->convert_newick2phyloXML($newick);
print $phylo_xml."\n";


done_testing();
